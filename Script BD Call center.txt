USE [master]
GO
CREATE DATABASE [DB_CALL_CENTER_PROGRA_III]
GO
USE [DB_CALL_CENTER_PROGRA_III]
GO

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 1 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

CREATE TABLE [dbo].[Tbl_Estados]
(
	Id_Estado CHAR(1) NOT NULL,
	Desc_Estado VARCHAR(65) NOT NULL,
	FecCreacion DATETIME NOT NULL,
	UsuCreacion VARCHAR(15) NOT NULL,
	FecModificacion DATETIME NULL,
	UsuModificacion VARCHAR(15) NULL,
	CONSTRAINT [PK_Estados] PRIMARY KEY CLUSTERED 
	(
		Id_Estado ASC
	)
) ON [PRIMARY]
GO
ALTER TABLE [dbo].[Tbl_Estados]
	ADD CONSTRAINT UNQ_DESC_ESTADO UNIQUE (Desc_Estado)

GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 1 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 2 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

CREATE TABLE [dbo].[Tbl_SemaforoCasos]
(
	Id_Estado_SemaforoCaso CHAR(1) NOT NULL,
	Desc_Estado_SemaforoCaso VARCHAR(65) NOT NULL,
	Color VARCHAR(65) NOT NULL,
	Id_Estado CHAR(1) NOT NULL,
	FecCreacion DATETIME NOT NULL,
	UsuCreacion VARCHAR(15) NOT NULL,
	FecModificacion DATETIME NULL,
	UsuModificacion VARCHAR(15) NULL,
	CONSTRAINT [PK_SemaforoCasos] PRIMARY KEY CLUSTERED 
	(
		Id_Estado_SemaforoCaso ASC
	)

) ON [PRIMARY]
GO
ALTER TABLE [dbo].[Tbl_SemaforoCasos]
	ADD CONSTRAINT UNQ_DESC_SEMAFOROCASOS UNIQUE (Desc_Estado_SemaforoCaso)
GO
ALTER TABLE [dbo].[Tbl_SemaforoCasos]
	ADD CONSTRAINT UNQ_COLOR_SEMAFOROCASOS UNIQUE (Color)
GO
ALTER TABLE [dbo].[Tbl_SemaforoCasos]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_SemaforoCasos_Estados] FOREIGN KEY([Id_Estado])
		REFERENCES [dbo].[Tbl_Estados] ([Id_Estado])
		GO
ALTER TABLE [dbo].[Tbl_SemaforoCasos]
	CHECK CONSTRAINT [FK_SemaforoCasos_Estados]
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 2 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 3 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

CREATE TABLE [dbo].[Tbl_TipoActivo]
(
	Id_TipoActivo INT IDENTITY(1,1) NOT NULL ,
	Desc_TipoActivo VARCHAR(65) NOT NULL,			
	Id_Estado CHAR(1) NOT NULL,
	FecCreacion DATETIME NOT NULL,
	UsuCreacion VARCHAR(15) NOT NULL,
	FecModificacion DATETIME NULL,
	UsuModificacion VARCHAR(15) NULL,
	CONSTRAINT [PK_TipoActivo] PRIMARY KEY CLUSTERED 
	(
		Id_TipoActivo ASC
	)
) ON [PRIMARY]
GO
ALTER TABLE [dbo].[Tbl_TipoActivo]
	ADD CONSTRAINT UNQ_DESC_TIPOACTIVO UNIQUE (Desc_TipoActivo)
GO
ALTER TABLE [dbo].[Tbl_TipoActivo]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_TipoActivo_Estados] FOREIGN KEY([Id_Estado])
		REFERENCES [dbo].[Tbl_Estados] ([Id_Estado])
		GO
ALTER TABLE [dbo].[Tbl_TipoActivo]
	CHECK CONSTRAINT [FK_TipoActivo_Estados]
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 3 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 4 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

CREATE TABLE [dbo].[Tbl_MarcaActivo]
(
	Id_MarcaActivo INT IDENTITY(1,1) NOT NULL,
	Desc_MarcaActivo VARCHAR(65) NOT NULL,			
	Id_Estado CHAR(1) NOT NULL,
	FecCreacion DATETIME NOT NULL,
	UsuCreacion VARCHAR(15) NOT NULL,
	FecModificacion DATETIME NULL,
	UsuModificacion VARCHAR(15) NULL,
	CONSTRAINT [PK_MarcaActivo] PRIMARY KEY CLUSTERED 
	(
		Id_MarcaActivo ASC
	)

) ON [PRIMARY]
GO
ALTER TABLE [dbo].[Tbl_MarcaActivo]
	ADD CONSTRAINT UNQ_DESC_MARCAACTIVO UNIQUE (Desc_MarcaActivo)
GO
ALTER TABLE [dbo].[Tbl_MarcaActivo]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_MarcaActivo_Estados] FOREIGN KEY([Id_Estado])
		REFERENCES [dbo].[Tbl_Estados] ([Id_Estado])
		GO
ALTER TABLE [dbo].[Tbl_MarcaActivo]
	CHECK CONSTRAINT [FK_MarcaActivo_Estados]
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 4 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 5 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

CREATE TABLE [dbo].[Tbl_Departamentos]
(
	Id_Departamento INT IDENTITY(1,1) NOT NULL,
	Desc_Departamento VARCHAR(65) NOT NULL,			
	Id_Estado CHAR(1) NOT NULL,
	FecCreacion DATETIME NOT NULL,
	UsuCreacion VARCHAR(15) NOT NULL,
	FecModificacion DATETIME NULL,
	UsuModificacion VARCHAR(15) NULL,
	CONSTRAINT [PK_Departamentos] PRIMARY KEY CLUSTERED 
	(
		Id_Departamento ASC
	)
) ON [PRIMARY]
GO
ALTER TABLE [dbo].[Tbl_Departamentos]
	ADD CONSTRAINT UNQ_DESC_DEPARTAMENTO UNIQUE (Desc_Departamento)
GO
ALTER TABLE [dbo].[Tbl_Departamentos]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_Departamentos_Estados] FOREIGN KEY([Id_Estado])
		REFERENCES [dbo].[Tbl_Estados] ([Id_Estado])
		GO
ALTER TABLE [dbo].[Tbl_Departamentos]
	CHECK CONSTRAINT [FK_Departamentos_Estados]
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 5 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 6 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

CREATE TABLE [dbo].[Tbl_Activos]
(
	Placa_Activo INT IDENTITY(1,1) NOT NULL ,
	Id_TipoActivo INT NOT NULL ,
	Desc_Activo VARCHAR(265) NOT NULL,	
	Id_MarcaActivo INT NOT NULL,
	Id_Departamento_Responsable INT NOT NULL ,
	Prioridad_SLA DECIMAL(8,2) NOT NULL,
	Id_Estado CHAR(1) NOT NULL,
	FecCreacion DATETIME NOT NULL,
	UsuCreacion VARCHAR(15) NOT NULL,
	FecModificacion DATETIME NULL,
	UsuModificacion VARCHAR(15) NULL,
	CONSTRAINT [PK_Activos] PRIMARY KEY CLUSTERED 
	(
		Placa_Activo ASC
	)
) ON [PRIMARY]
GO
ALTER TABLE [dbo].[Tbl_Activos]
	ADD CONSTRAINT UNQ_DESC_ACTIVO UNIQUE (Desc_Activo)
GO
ALTER TABLE [dbo].[Tbl_Activos]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_Activos_TipoActivo] FOREIGN KEY([Id_TipoActivo])
		REFERENCES [dbo].[Tbl_TipoActivo] ([Id_TipoActivo])
GO
ALTER TABLE [dbo].[Tbl_Activos]
	CHECK CONSTRAINT [FK_Activos_TipoActivo]
GO
ALTER TABLE [dbo].[Tbl_Activos]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_Activos_MarcaActivo] FOREIGN KEY([Id_MarcaActivo])
		REFERENCES [dbo].[Tbl_MarcaActivo] ([Id_MarcaActivo])
GO
ALTER TABLE [dbo].[Tbl_Activos]
	CHECK CONSTRAINT [FK_Activos_MarcaActivo]
GO
ALTER TABLE [dbo].[Tbl_Activos]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_Activos_Departamentos] FOREIGN KEY([Id_Departamento_Responsable])
		REFERENCES [dbo].[Tbl_Departamentos] ([Id_Departamento])
GO
ALTER TABLE [dbo].[Tbl_Activos]
	CHECK CONSTRAINT [FK_Activos_Departamentos]
GO
ALTER TABLE [dbo].[Tbl_Activos]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_Activos_Estados] FOREIGN KEY([Id_Estado])
		REFERENCES [dbo].[Tbl_Estados] ([Id_Estado])
GO
ALTER TABLE [dbo].[Tbl_Activos]
	CHECK CONSTRAINT [FK_Activos_Estados]

GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 6 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 7 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

CREATE TABLE [dbo].[Tbl_Turnos]
(
	Id_Turno CHAR(1) NOT NULL,
	Desc_Turno VARCHAR(65) NOT NULL,			
	Cant_Horas INT NOT NULL,
	HoraEntrada VARCHAR(10) NOT NULL,
	HoraSalida VARCHAR(10) NOT NULL,
	Id_Estado CHAR(1) NOT NULL,
	FecCreacion DATETIME NOT NULL,
	UsuCreacion VARCHAR(15) NOT NULL,
	FecModificacion DATETIME NULL,
	UsuModificacion VARCHAR(15) NULL,
	CONSTRAINT [PK_Turnos] PRIMARY KEY CLUSTERED 
	(
		Id_Turno ASC
	)
) ON [PRIMARY]
GO
ALTER TABLE [dbo].[Tbl_Turnos]
	ADD CONSTRAINT UNQ_DESC_TURNOS UNIQUE (Desc_Turno)
GO
ALTER TABLE [dbo].[Tbl_Turnos]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_Turnos_Estados] FOREIGN KEY([Id_Estado])
		REFERENCES [dbo].[Tbl_Estados] ([Id_Estado])
		GO
ALTER TABLE [dbo].[Tbl_Turnos]
	CHECK CONSTRAINT [FK_Turnos_Estados]
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 7 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 8 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

CREATE TABLE [dbo].[Tbl_Operadores]
(
	Id_Operador VARCHAR(11) NOT NULL,
	Nombre_Operador VARCHAR(45) NOT NULL,
	Apellidos_Operador VARCHAR(140) NOT NULL,
	NickNameOperador VARCHAR(10) NOT NULL, 
	Id_Turno CHAR(1) NOT NULL,
	Nivel VARCHAR(65) NOT NULL,
	Id_Estado CHAR(1) NOT NULL,
	FecCreacion DATETIME NOT NULL,
	UsuCreacion VARCHAR(15) NOT NULL,
	FecModificacion DATETIME NULL,
	UsuModificacion VARCHAR(15) NULL,
	CONSTRAINT [PK_Operadores] PRIMARY KEY CLUSTERED 
	(
		Id_Operador ASC
	)
) ON [PRIMARY]
GO
ALTER TABLE [dbo].[Tbl_Operadores]
	ADD CONSTRAINT UNQ_DESC_OPERADOR UNIQUE (NickNameOperador)
GO
ALTER TABLE [dbo].[Tbl_Operadores]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_Operadores_Turnos] FOREIGN KEY([Id_Turno])
		REFERENCES [dbo].[Tbl_Turnos] ([Id_Turno])
GO
ALTER TABLE [dbo].[Tbl_Operadores]
	CHECK CONSTRAINT [FK_Operadores_Turnos]
GO
ALTER TABLE [dbo].[Tbl_Operadores]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_Operadores_Estados] FOREIGN KEY([Id_Estado])
		REFERENCES [dbo].[Tbl_Estados] ([Id_Estado])
GO
ALTER TABLE [dbo].[Tbl_Operadores]
	CHECK CONSTRAINT [FK_Operadores_Estados]
GO


-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 8 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 9 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

CREATE TABLE [dbo].[Tbl_Caso_Encabezado]
(
	Id_Caso_Enc INT IDENTITY(1,1) NOT NULL,	
	Fecha DATETIME NOT NULL,
	Id_Operador VARCHAR(11) NOT NULL,
	ComentariosReporte VARCHAR(450) NOT NULL,
	Id_Estado_SemaforoCaso CHAR(1) NOT NULL,						
	Id_Estado CHAR(1) NOT NULL,
	FecCreacion DATETIME NOT NULL,
	UsuCreacion VARCHAR(15) NOT NULL,
	FecModificacion DATETIME NULL,
	UsuModificacion VARCHAR(15) NULL,
	CONSTRAINT [PK_Caso_Encabezado] PRIMARY KEY CLUSTERED 
	(
		Id_Caso_Enc ASC
	)
) ON [PRIMARY]
GO
ALTER TABLE [dbo].[Tbl_Caso_Encabezado]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_Caso_Encabezado_Operadores] FOREIGN KEY([Id_Operador])
		REFERENCES [dbo].[Tbl_Operadores] ([Id_Operador])
GO
ALTER TABLE [dbo].[Tbl_Caso_Encabezado]
	CHECK CONSTRAINT [FK_Caso_Encabezado_Operadores]
GO	
ALTER TABLE [dbo].[Tbl_Caso_Encabezado]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_Caso_Encabezado_SemaforoCasos] FOREIGN KEY([Id_Estado_SemaforoCaso])
		REFERENCES [dbo].[Tbl_SemaforoCasos] ([Id_Estado_SemaforoCaso])
GO
ALTER TABLE [dbo].[Tbl_Caso_Encabezado]
	CHECK CONSTRAINT [FK_Caso_Encabezado_SemaforoCasos]
GO	
ALTER TABLE [dbo].[Tbl_Caso_Encabezado]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_Caso_Encabezado_Estados] FOREIGN KEY([Id_Estado])
		REFERENCES [dbo].[Tbl_Estados] ([Id_Estado])
GO
ALTER TABLE [dbo].[Tbl_Caso_Encabezado]
	CHECK CONSTRAINT [FK_Caso_Encabezado_Estados]
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 9 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 10 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

CREATE TABLE [dbo].[Tbl_Caso_Detalle]
(
	Id_Caso_Det INT IDENTITY(1,1) NOT NULL,	
	Id_Caso_Enc INT NOT NULL,	
	Placa_Activo INT NOT NULL,
	Observaciones VARCHAR(450) NOT NULL,
	FecCreacion DATETIME NOT NULL,
	UsuCreacion VARCHAR(15) NOT NULL,
	FecModificacion DATETIME NULL,
	UsuModificacion VARCHAR(15) NULL,

	CONSTRAINT [PK_Caso_Detalle] PRIMARY KEY CLUSTERED 
	(
		Id_Caso_Det ASC
	)
) ON [PRIMARY]
GO	
ALTER TABLE [dbo].[Tbl_Caso_Detalle]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_Caso_Detalle_Encabezado] FOREIGN KEY([Id_Caso_Enc])
		REFERENCES [dbo].[Tbl_Caso_Encabezado] ([Id_Caso_Enc])
GO
ALTER TABLE [dbo].[Tbl_Caso_Detalle]
	CHECK CONSTRAINT [FK_Caso_Detalle_Encabezado]
GO	
ALTER TABLE [dbo].[Tbl_Caso_Detalle]  WITH NOCHECK 
	ADD  CONSTRAINT [FK_Caso_Detalle_Activos] FOREIGN KEY([Placa_Activo])
		REFERENCES [dbo].[Tbl_Activos] ([Placa_Activo])
GO
ALTER TABLE [dbo].[Tbl_Caso_Detalle]
	CHECK CONSTRAINT [FK_Caso_Detalle_Activos]
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 10 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 2 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-- Consultar
CREATE PROCEDURE SP_LISTAR_SEMAFOROCASOS
AS
SELECT [Id_Estado_SemaforoCaso] AS "Código"
      ,[Desc_Estado_SemaforoCaso] AS "Descripción"
      ,[Color]
      ,te.[Desc_Estado] AS Estado
      ,tsc.[FecCreacion] AS "Fecha de Creación"
      ,tsc.[UsuCreacion] AS "Creado por"
      ,tsc.[FecModificacion] AS "Fecha de Modificación"
      ,tsc.[UsuModificacion] AS "Modificado por"
  FROM [dbo].[Tbl_SemaforoCasos] tsc
  INNER JOIN [dbo].[Tbl_Estados] te ON tsc.Id_Estado = te.Id_Estado
GO

-- Filtrar
CREATE PROCEDURE SP_FILTRAR_SEMAFOROCASOS
(
	@Desc_Estado_SemaforoCaso varchar(65)
)
AS
SELECT [Id_Estado_SemaforoCaso] AS "Código"
      ,[Desc_Estado_SemaforoCaso] AS "Descripción"
      ,[Color]
      ,te.[Desc_Estado] AS Estado
      ,tsc.[FecCreacion] AS "Fecha de Creación"
      ,tsc.[UsuCreacion] AS "Creado por"
      ,tsc.[FecModificacion] AS "Fecha de Modificación"
      ,tsc.[UsuModificacion] AS "Modificado por"
  FROM [dbo].[Tbl_SemaforoCasos] tsc
  INNER JOIN [dbo].[Tbl_Estados] te ON tsc.Id_Estado = te.Id_Estado
  WHERE [Desc_Estado_SemaforoCaso] LIKE '%' + @Desc_Estado_SemaforoCaso + '%'
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 2 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 3 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-- Consultar
CREATE PROCEDURE SP_LISTAR_TIPOACTIVO
AS
SELECT [Id_TipoActivo] AS "Código"
      ,[Desc_TipoActivo] AS "Descripción"
      ,tta.[Id_Estado] AS Estado
      ,tta.[FecCreacion] AS "Fecha de Creación"
      ,tta.[UsuCreacion] AS "Creado por"
      ,tta.[FecModificacion] AS "Fecha de Modificación"
      ,tta.[UsuModificacion] AS "Modificado por"
  FROM [dbo].[Tbl_TipoActivo] tta
  INNER JOIN [dbo].[Tbl_Estados] te ON tta.Id_Estado = te.Id_Estado
GO

-- Filtrar
CREATE PROCEDURE SP_FILTRAR_TIPOACTIVO
(
	@Desc_TipoActivo varchar(65)
)
AS
SELECT [Id_TipoActivo] AS "Código"
      ,[Desc_TipoActivo] AS "Descripción"
      ,tta.[Id_Estado] AS Estado
      ,tta.[FecCreacion] AS "Fecha de Creación"
      ,tta.[UsuCreacion] AS "Creado por"
      ,tta.[FecModificacion] AS "Fecha de Modificación"
      ,tta.[UsuModificacion] AS "Modificado por"
  FROM [dbo].[Tbl_TipoActivo] tta
  INNER JOIN [dbo].[Tbl_Estados] te ON tta.Id_Estado = te.Id_Estado
  WHERE [Desc_TipoActivo] LIKE '%' + @Desc_TipoActivo + '%'
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 3 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 5 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-- Filtrar
CREATE PROCEDURE [dbo].[SP_LISTAR_DEPARTAMENTOS]
(
	@Desc nvarchar(265) = '',
	@Id int = -1
)
AS
BEGIN   
  IF @Desc IS NULL
		SET @Desc = '';

  IF @Id < 0
		SET @Id = -1;

  SELECT [Id_Departamento] AS "Id"
      ,[Desc_Departamento] AS "Descripcion"
      ,td.[Id_Estado] AS Estado
      ,td.[FecCreacion] AS "FechaCreacion"
      ,td.[UsuCreacion] AS "CreadoUsuario"
      ,td.[FecModificacion] AS "FechaModificacion"
      ,td.[UsuModificacion] AS "ModificadoUsuario"
  FROM [dbo].[Tbl_Departamentos] td
  INNER JOIN [dbo].[Tbl_Estados] te ON td.Id_Estado = te.Id_Estado
  WHERE [Desc_Departamento] LIKE '%' + @Desc + '%' AND (Id_Departamento = @Id OR @Id < 0)
END
GO

CREATE PROCEDURE [dbo].[SP_MODIFICAR_DEPARTAMENTO]
(
	@Descripcion VARCHAR(65),
	@FechaModificacion DATETIME,
	@IdEstado CHAR,
	@Id INT
)
AS
BEGIN
	UPDATE [dbo].[Tbl_Departamentos]
	SET [Desc_Departamento] = @Descripcion
	   ,[Id_Estado] = @IdEstado
       ,[FecModificacion] = @FechaModificacion
	   ,[UsuModificacion] = SUBSTRING(ORIGINAL_LOGIN(), CHARINDEX('\', ORIGINAL_LOGIN(), 0) + 1,15)
	WHERE Id_Departamento = @Id
END
GO

CREATE PROCEDURE [dbo].[SP_INSERTAR_DEPARTAMENTO]
(
	@Descripcion VARCHAR(65),
	@FechaCreacion DATETIME,
	@IdEstado CHAR
)
AS
BEGIN
	INSERT INTO [dbo].[Tbl_Departamentos]
           ([Desc_Departamento]
           ,[Id_Estado]
           ,[FecCreacion]
           ,[UsuCreacion])
	VALUES
           (@Descripcion
           ,@IdEstado
           ,@FechaCreacion
           ,SUBSTRING(ORIGINAL_LOGIN(), CHARINDEX('\', ORIGINAL_LOGIN(), 0) + 1,15)           )

	SELECT SCOPE_IDENTITY()
END
GO

CREATE PROCEDURE [dbo].[SP_GET_ESTADOS]
AS
BEGIN
	SELECT [Id_Estado] AS "Id"
      ,[Desc_Estado] AS "Descripcion"      
	FROM [dbo].[Tbl_Estados]
	ORDER BY Desc_Estado ASC
END
GO

CREATE PROCEDURE [dbo].SP_BORRAR_DEPARTAMENTOS
(
	@Id INT
)
AS
BEGIN
	DELETE FROM [dbo].[Tbl_Departamentos]
    WHERE Id_Departamento = @Id
END
GO
-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 5 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 6 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-- Consultar
CREATE PROCEDURE SP_LISTAR_ACTIVOS
AS
SELECT [Placa_Activo] AS "Placa"
      ,tac.[Desc_TipoActivo] AS "Tipo"
      ,[Desc_Activo] AS "Descripción"
      ,tma.[Desc_MarcaActivo] AS "Marca"
      ,td.[Desc_Departamento] AS "Departamento Responsable"
      ,[Prioridad_SLA] AS "Prioridad (SLA)"
      ,te.[Desc_Estado] AS Estado
      ,ta.[FecCreacion] AS "Fecha de Creación"
      ,ta.[UsuCreacion] AS "Creado por"
      ,ta.[FecModificacion] AS "Fecha de Modificación"
      ,ta.[UsuModificacion] AS "Modificado por"
  FROM [dbo].[Tbl_Activos] ta
  INNER JOIN [dbo].[Tbl_Estados] te ON ta.Id_Estado = te.Id_Estado
  INNER JOIN [dbo].[Tbl_TipoActivo] tac ON ta.Id_TipoActivo = tac.Id_TipoActivo
  INNER JOIN [dbo].[Tbl_MarcaActivo] tma ON ta.Id_MarcaActivo = tma.Id_MarcaActivo
  INNER JOIN [dbo].[Tbl_Departamentos] td ON ta.Id_Departamento_Responsable = td.Id_Departamento
GO

-- Filtrar
CREATE PROCEDURE SP_FILTRAR_ACTIVOS
(
	@Desc_Activo nvarchar(265)
)
AS
SELECT [Placa_Activo] AS "Placa"
      ,tac.[Desc_TipoActivo] AS "Tipo"
      ,[Desc_Activo] AS "Descripción"
      ,tma.[Desc_MarcaActivo] AS "Marca"
      ,td.[Desc_Departamento] AS "Departamento Responsable"
      ,[Prioridad_SLA] AS "Prioridad (SLA)"
      ,te.[Desc_Estado] AS Estado
      ,ta.[FecCreacion] AS "Fecha de Creación"
      ,ta.[UsuCreacion] AS "Creado por"
      ,ta.[FecModificacion] AS "Fecha de Modificación"
      ,ta.[UsuModificacion] AS "Modificado por"
  FROM [dbo].[Tbl_Activos] ta
  INNER JOIN [dbo].[Tbl_Estados] te ON ta.Id_Estado = te.Id_Estado
  INNER JOIN [dbo].[Tbl_TipoActivo] tac ON ta.Id_TipoActivo = tac.Id_TipoActivo
  INNER JOIN [dbo].[Tbl_MarcaActivo] tma ON ta.Id_MarcaActivo = tma.Id_MarcaActivo
  INNER JOIN [dbo].[Tbl_Departamentos] td ON ta.Id_Departamento_Responsable = td.Id_Departamento
  WHERE [Desc_Activo] LIKE '%' + @Desc_Activo + '%'
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 6 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 7 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-- Consultar
CREATE PROCEDURE SP_LISTAR_TURNOS
AS
SELECT [Id_Turno] AS "Código"
      ,[Desc_Turno] AS "Descripción"
      ,[Cant_Horas] AS "Cantidad de horas"
      ,[HoraEntrada] AS "Hora de Entrada"
      ,[HoraSalida] AS "Hora de Salida"
      ,te.[Desc_Estado] AS Estado
      ,tt.[FecCreacion] AS "Fecha de Creación"
      ,tt.[UsuCreacion] AS "Creado por"
      ,tt.[FecModificacion] AS "Fecha de Modificación"
      ,tt.[UsuModificacion] AS "Modificado por"
  FROM [dbo].[Tbl_Turnos] tt
  INNER JOIN [dbo].[Tbl_Estados] te ON tt.Id_Estado = te.Id_Estado
GO

-- Filtrar
CREATE PROCEDURE SP_FILTRAR_TURNOS
(
	@Desc_Turno varchar(65)
)
AS
SELECT [Id_Turno] AS "Código"
      ,[Desc_Turno] AS "Descripción"
      ,[Cant_Horas] AS "Cantidad de horas"
      ,[HoraEntrada] AS "Hora de Entrada"
      ,[HoraSalida] AS "Hora de Salida"
      ,te.[Desc_Estado] AS Estado
      ,tt.[FecCreacion] AS "Fecha de Creación"
      ,tt.[UsuCreacion] AS "Creado por"
      ,tt.[FecModificacion] AS "Fecha de Modificación"
      ,tt.[UsuModificacion] AS "Modificado por"
  FROM [dbo].[Tbl_Turnos] tt
  INNER JOIN [dbo].[Tbl_Estados] te ON tt.Id_Estado = te.Id_Estado
  WHERE [Desc_Turno] LIKE '%' + @Desc_Turno + '%'
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 7 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 8 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-- Consultar
CREATE PROCEDURE SP_LISTAR_OPERADORES
AS
SELECT [Id_Operador] AS "Código"
      ,[Nombre_Operador] AS Nombre
      ,[Apellidos_Operador] AS Apellidos
      ,[NickNameOperador] AS Usuario
      ,tt.[Desc_Turno] AS Turno
      ,[Nivel]
      ,te.[Desc_Estado] AS Estado
      ,tbo.[FecCreacion] AS "Fecha de Creación"
      ,tbo.[UsuCreacion] AS "Creado por"
      ,tbo.[FecModificacion] AS "Fecha de Modificación"
      ,tbo.[UsuModificacion] AS "Modificado por"
  FROM [dbo].[Tbl_Operadores] tbo
  INNER JOIN [dbo].[Tbl_Estados] te ON tbo.Id_Estado = te.Id_Estado
  INNER JOIN [dbo].[Tbl_Turnos] tt ON tbo.[Id_Turno] = tt.Id_Turno
GO

-- Filtrar
CREATE PROCEDURE SP_FILTRAR_OPERADORES
(
	@Id_Operador varchar(11)
)
AS
SELECT [Id_Operador] AS "Código"
      ,[Nombre_Operador] AS Nombre
      ,[Apellidos_Operador] AS Apellidos
      ,[NickNameOperador] AS Usuario
      ,tt.[Desc_Turno] AS Turno
      ,[Nivel]
      ,te.[Desc_Estado] AS Estado
      ,tbo.[FecCreacion] AS "Fecha de Creación"
      ,tbo.[UsuCreacion] AS "Creado por"
      ,tbo.[FecModificacion] AS "Fecha de Modificación"
      ,tbo.[UsuModificacion] AS "Modificado por"
  FROM [dbo].[Tbl_Operadores] tbo
  INNER JOIN [dbo].[Tbl_Estados] te ON tbo.Id_Estado = te.Id_Estado
  INNER JOIN [dbo].[Tbl_Turnos] tt ON tbo.[Id_Turno] = tt.Id_Turno
  WHERE [Id_Operador] LIKE '%' + @Id_Operador + '%'
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 8 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 9 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-- Consultar
CREATE PROCEDURE SP_LISTAR_CASO_ENCABEZADO
AS
SELECT [Id_Caso_Enc] AS "Código"
      ,[Fecha]
      ,[Id_Operador] AS "Operador"
      ,[ComentariosReporte] AS "Comentarios"
      ,tsc.[Desc_Estado_SemaforoCaso] AS "Semáforo"
      ,te.[Desc_Estado] AS "Estado"
      ,tce.[FecCreacion] AS "Fecha de Creación"
      ,tce.[UsuCreacion] AS "Creado por"
      ,tce.[FecModificacion] AS "Fecha de Modificación"
      ,tce.[UsuModificacion] AS "Modificado por"
  FROM [dbo].[Tbl_Caso_Encabezado] tce
  INNER JOIN [dbo].[Tbl_Estados] te ON tce.Id_Estado = te.Id_Estado
  INNER JOIN [dbo].[Tbl_SemaforoCasos] tsc ON tce.Id_Estado_SemaforoCaso = tsc.Id_Estado_SemaforoCaso
GO

-- Filtrar
CREATE PROCEDURE SP_FILTRAR_CASO_ENCABEZADO
(
	@ComentariosReporte varchar(450)
)
AS
SELECT [Id_Caso_Enc] AS "Código"
      ,[Fecha]
      ,[Id_Operador] AS "Operador"
      ,[ComentariosReporte] AS "Comentarios"
      ,tsc.[Desc_Estado_SemaforoCaso] AS "Semáforo"
      ,te.[Desc_Estado] AS "Estado"
      ,tce.[FecCreacion] AS "Fecha de Creación"
      ,tce.[UsuCreacion] AS "Creado por"
      ,tce.[FecModificacion] AS "Fecha de Modificación"
      ,tce.[UsuModificacion] AS "Modificado por"
  FROM [dbo].[Tbl_Caso_Encabezado] tce
  INNER JOIN [dbo].[Tbl_Estados] te ON tce.Id_Estado = te.Id_Estado
  INNER JOIN [dbo].[Tbl_SemaforoCasos] tsc ON tce.Id_Estado_SemaforoCaso = tsc.Id_Estado_SemaforoCaso
  WHERE [ComentariosReporte] LIKE '%' + @ComentariosReporte + '%'
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 9 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 10 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-- Consultar
CREATE PROCEDURE SP_LISTAR_CASO_DETALLE
AS
SELECT [Id_Caso_Det] AS "Código"
      ,tce.ComentariosReporte AS "Encabezado"
      ,[Placa_Activo] AS "Placa"
      ,[Observaciones]
      ,tcd.[FecCreacion] AS "Fecha de Creación"
      ,tcd.[UsuCreacion] AS "Creado por"
      ,tcd.[FecModificacion] AS "Fecha de Modificación"
      ,tcd.[UsuModificacion] AS "Modificado por"
  FROM [dbo].[Tbl_Caso_Detalle] tcd
  INNER JOIN [dbo].[Tbl_Caso_Encabezado] tce ON tcd.Id_Caso_Enc = tce.Id_Caso_Enc
GO

-- Filtrar
CREATE PROCEDURE SP_FILTRAR_CASO_DETALLE
(
	@Observaciones varchar(450)
)
AS
SELECT [Id_Caso_Det] AS "Código"
      ,tce.ComentariosReporte AS "Encabezado"
      ,[Placa_Activo] AS "Placa"
      ,[Observaciones]
      ,tcd.[FecCreacion] AS "Fecha de Creación"
      ,tcd.[UsuCreacion] AS "Creado por"
      ,tcd.[FecModificacion] AS "Fecha de Modificación"
      ,tcd.[UsuModificacion] AS "Modificado por"
  FROM [dbo].[Tbl_Caso_Detalle] tcd
  INNER JOIN [dbo].[Tbl_Caso_Encabezado] tce ON tcd.Id_Caso_Enc = tce.Id_Caso_Enc
  WHERE [Observaciones] LIKE '%' + @Observaciones + '%'
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 10 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 1 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

INSERT INTO [dbo].[Tbl_Estados]
     VALUES
           ('1','Activo',GETDATE(),'admin',NULL,NULL)
		   ,('2','Inactivo',GETDATE(),'admin',NULL,NULL)
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 1 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 2 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

INSERT INTO [dbo].[Tbl_SemaforoCasos]
     VALUES
           ('1','Abierto','Verde','1',GETDATE(),'admin',NULL,NULL)
		   ,('2','Cerrado','Rojo','1',GETDATE(),'admin',NULL,NULL)
		   ,('3','En progreso','Amarillo','1',GETDATE(),'admin',NULL,NULL)
		   ,('4','Pendiente de revisión','Azul','2',GETDATE(),'admin',NULL,NULL)
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 2 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 3 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

INSERT INTO [dbo].[Tbl_TipoActivo]
     VALUES
           ('Fijo','1',GETDATE(),'admin',NULL,NULL)
		   ,('Circulante','2',GETDATE(),'admin',NULL,NULL)
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 3 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 4 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

INSERT INTO [dbo].[Tbl_MarcaActivo]
     VALUES
           ('Toyota','1',GETDATE(),'admin',NULL,NULL)
		   ,('Genérico','1',GETDATE(),'admin',NULL,NULL)
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 4 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 5 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

INSERT INTO [dbo].[Tbl_Departamentos]
     VALUES
           ('Servicio al cliente','1',GETDATE(),'admin',NULL,NULL)
		   ,('Cobros','1',GETDATE(),'admin',NULL,NULL)
		   ,('Soporte','1',GETDATE(),'admin',NULL,NULL)
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 5 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 6 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

INSERT INTO [dbo].[Tbl_Activos]
     VALUES
           ('1','Vehículo',1,3,10,'1',GETDATE(),'admin',NULL,NULL)
		   ,('2','Deudores',2,2,20,'1',GETDATE(),'admin',NULL,NULL)
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 6 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 7 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

INSERT INTO [dbo].[Tbl_Turnos]
     VALUES
           ('1','Diurno',8,'06:00','15:00',1,GETDATE(),'admin',NULL,NULL)
		   ,('2','Nocturno',6,'22:00','05:00',1,GETDATE(),'admin',NULL,NULL)
		   ,('3','Mixto',8,'14:00','22:00',1,GETDATE(),'admin',NULL,NULL)
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 7 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 8 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

INSERT INTO [dbo].[Tbl_Operadores]
     VALUES
           ('Operador 1','Adrián','Araya','aaraya','1','Nivel 0','1',GETDATE(),'admin',NULL,NULL)
		   ,('Operador 2','Jorge','Lefebre','jlefebre','2','Nivel 0','1',GETDATE(),'admin',NULL,NULL)
		   ,('Operador 3','Wilberth','Martínez','wmartinez','3','Nivel 0','2',GETDATE(),'admin',NULL,NULL)
		   ,('Operador 4','Cristopher','Robles','crobles','1','Nivel 0','1',GETDATE(),'admin',NULL,NULL)
		   ,('Operador 5','Carlos','Torres','ctorres','2','Nivel 0','1',GETDATE(),'admin',NULL,NULL)
		   ,('Operador 6','Marvin','Ureña','murena','3','Nivel 0','1',GETDATE(),'admin',NULL,NULL)
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 8 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 9 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

INSERT INTO [dbo].[Tbl_Caso_Encabezado]
     VALUES
           (GETDATE(),'Operador 1','Comentario detalle 1','1','1',GETDATE(),'admin',NULL,NULL)
		   ,(GETDATE(),'Operador 2','Comentario detalle 2','2','1',GETDATE(),'admin',NULL,NULL)
		   ,(GETDATE(),'Operador 3','Comentario detalle 3','3','1',GETDATE(),'admin',NULL,NULL)
		   ,(GETDATE(),'Operador 4','Comentario detalle 4','1','1',GETDATE(),'admin',NULL,NULL)
		   ,(GETDATE(),'Operador 5','Comentario detalle 5','2','1',GETDATE(),'admin',NULL,NULL)
		   ,(GETDATE(),'Operador 6','Comentario detalle 6','3','1',GETDATE(),'admin',NULL,NULL)
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 9 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------
-- ****************************************************** TABLA # 10 ****************************************************** --
-----------------------------------------------------------------------------------------------------------------------------

INSERT INTO [dbo].[Tbl_Caso_Detalle]
     VALUES
           (1,1,'Sin observaciones',GETDATE(),'admin',NULL,NULL)
		   ,(2,2,'Sin observaciones',GETDATE(),'admin',NULL,NULL)
		   ,(3,1,'Sin observaciones',GETDATE(),'admin',NULL,NULL)
		   ,(4,2,'Sin observaciones',GETDATE(),'admin',NULL,NULL)
		   ,(5,1,'Sin observaciones',GETDATE(),'admin',NULL,NULL)
		   ,(6,2,'Sin observaciones',GETDATE(),'admin',NULL,NULL)
GO

-----------------------------------------------------------------------------------------------------------------------------
-- **************************************************** FIN TABLA # 10 **************************************************** --
-----------------------------------------------------------------------------------------------------------------------------




-- **************************************************** ELIMINAR pROCEDURES **************************************************** --

create procedure SP_ELIMINAR_ACTIVOS
(
	@Placa_Activo INT
)
AS
DELETE FROM [dbo].[Tbl_Activos] WHERE Placa_Activo = @Placa_Activo
GO



















